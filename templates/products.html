{% extends "_base.html" %}
{% block title %}สินค้า{% endblock %}
{% block content %}
<h1 class="text-xl font-semibold mb-4">สินค้า</h1>

<form class="bg-white border rounded-xl p-4 shadow-sm mb-6" method="post" action="{{ url_for('product_create') }}">
  <div class="grid md:grid-cols-4 gap-3">
    <input name="name" placeholder="ชื่อสินค้า" required class="p-2 border rounded">
    <input name="price" type="number" step="0.01" placeholder="ราคา" required class="p-2 border rounded">
    <input name="category" placeholder="หมวด (เช่น เค้ก, ขนมปัง)" class="p-2 border rounded">
    <input name="image" placeholder="ลิงก์รูปภาพ (ไม่บังคับ)" class="p-2 border rounded">
  </div>
  <div class="mt-3">
    <button class="px-4 py-2 bg-black text-white rounded">+ เพิ่มสินค้า</button>
  </div>
</form>

<table class="w-full bg-white border rounded-xl shadow-sm">
  <thead>
    <tr class="text-left border-b">
      <th class="p-2">รูป</th><th class="p-2">ชื่อ</th><th class="p-2">ราคา</th>
      <th class="p-2">หมวด</th><th class="p-2">สถานะ</th><th class="p-2"></th>
    </tr>
  </thead>
  <tbody>
    {% for p in products %}
    <tr class="border-b">
      <td class="p-2">{% if p.image %}<img src="{{ p.image }}" class="w-14 h-14 object-cover rounded">{% endif %}</td>
      <td class="p-2">{{ p.name }}</td>
      <td class="p-2">฿{{ '%.2f'|format(p.price) }}</td>
      <td class="p-2">{{ p.category }}</td>
      <td class="p-2">{{ 'ขาย' if p.active else 'ปิดขาย' }}</td>
      <td class="p-2 flex gap-2">
        <form method="post" action="{{ url_for('product_toggle', pid=p.id) }}">
          <button class="px-3 py-1 border rounded">{{ 'ปิด' if p.active else 'เปิด' }}</button>
        </form>
        <details>
          <summary class="px-3 py-1 border rounded cursor-pointer inline-block">แก้ไข</summary>
          <form class="mt-2" method="post" action="{{ url_for('product_update', pid=p.id) }}">
            <div class="grid md:grid-cols-4 gap-2">
              <input name="name" value="{{ p.name }}" class="p-2 border rounded">
              <input name="price" value="{{ p.price }}" type="number" step="0.01" class="p-2 border rounded">
              <input name="category" value="{{ p.category }}" class="p-2 border rounded">
              <input name="image" value="{{ p.image }}" class="p-2 border rounded">
            </div>
            <button class="mt-2 px-3 py-1 bg-emerald-600 text-white rounded">บันทึก</button>
          </form>
        </details>
        <form method="post" action="{{ url_for('product_delete', pid=p.id) }}" onsubmit="return confirm('ลบสินค้า?')">
          <button class="px-3 py-1 border rounded">ลบ</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
